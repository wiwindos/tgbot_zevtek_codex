### Итерация 10 — **Polish & Docs Finish**

*(финальный штрих проекта; план T – F – I – P, актуален для `wiwindos/tgbot_zevtek_codex` после Iter 9)*

---

#### Текущее состояние репозитория

| Факт                                                                              | Где видно                             |
| --------------------------------------------------------------------------------- | ------------------------------------- |
| Функциональность завершена (бот, провайдеры, прокси, контекст, Docker, CI).       | `bot/*`, `providers/*`, `scheduler/*` |
| Типы проставлены частично; `mypy` запускается в *silent-mode* (errors ≠ CI-fail). | `.github/workflows/ci.yml`            |
| Покрытие тестами ≈ 78 % (unit-тесты + docker-тесты локально).                     | `pytest --cov` (локально)             |
| Документация: README, `docs/deploy.md`; нет API-референса и CHANGELOG.            | `README.md`, `docs/*`                 |
| Лицензия MIT, но нет фай-ла `CONTRIBUTING.md`, issue/PR templates.                | `LICENSE`                             |
| Версионирование в коде отсутствует (`__version__` не задан).                      | —                                     |

---

## 1 T — **Test first**

| № | Тест-задача                                                            | Проверка                                                                            |
| - | ---------------------------------------------------------------------- | ----------------------------------------------------------------------------------- |
| 1 | **Критический путь “/start ➜ /model ➜ file upload”** *(e2e в 1 тесте)* | Использовать `pytest` + `aiogram-testing` client: сценарий проходит без исключений. |
| 2 | **Static-type gate**                                                   | Запускаем `mypy --strict .` в отдельном `pytest`-тесте и ассертим что exit-code 0.  |
| 3 | **Coverage gate**                                                      | `pytest --cov` должен выдавать `>= 85 %`; если ниже → тест падает.                  |

(В CI эти проверки станут частью workflow.)

---

## 2 F — **Feature / Финальный функционал**

| №   | Задача                                                                                                | Где правим                                                    |
| --- | ----------------------------------------------------------------------------------------------------- | ------------------------------------------------------------- |
| 2.1 | **Полная typing-аннотация** (`mypy --strict`): слой `services`, `bot/admin_router.py`, `providers/*`. | правки файлов                                                 |
| 2.2 | **`__init__.py` → `__version__`**; semantic-версия берётся из `pyproject.toml` или `version.txt`.     | `bot/__init__.py`                                             |
| 2.3 | **Coverage badge** (Codecov) + отчёт.                                                                 | `.github/workflows/ci.yml`, `README.md`                       |
| 2.4 | **ruff** как быстрый линтер (заменяет flake8 + isort); конфиг `pyproject.toml`.                       | `.pre-commit-config.yaml`, `ci.yml`                           |
| 2.5 | **Sphinx или MkDocs** билд API-docs: autogenerated from docstrings; GitHub Pages publish via `docs/`. | `docs/conf.py` или `mkdocs.yml`                               |
| 2.6 | **CHANGELOG.md** (Keep a Changelog format), autopopulate при релизах.                                 | `CHANGELOG.md`                                                |
| 2.7 | **`CONTRIBUTING.md` + issue/PR templates** (GitHub).                                                  | `.github/ISSUE_TEMPLATE/`, `.github/PULL_REQUEST_TEMPLATE.md` |
| 2.8 | **Semantic Release tag helper** (`semantic-release` or `git-cliff`) to bump version & changelog.      | `.github/workflows/release.yml`                               |

---

## 3 I — **Integrate**

| Направление          | Шаги                                                                                                                                                                   |
| -------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **CI**               | *Обновить* `ci.yml`:<br>`yaml\n- run: ruff check .\n- run: mypy --strict .\n- run: pytest -m \"not docker\" --cov=.\n- run: codecov -t ${{ secrets.CODECOV_TOKEN }}\n` |
| **Pre-commit**       | Hook-сет: `ruff-format`, `mypy`, `black` (со строгим line-length = 100).                                                                                               |
| **Docs publish**     | Job `gh-pages`: `mkdocs build` → `peaceiris/actions-gh-pages@v4`.                                                                                                      |
| **Badges**           | CI status, coverage %, Docker pulls, GHCR size.                                                                                                                        |
| **README**           | Добавить секции: **Features**, **Quick Start**, **Proxy setup**, **Admin Commands**, **FAQ**.                                                                          |
| **Release workflow** | на тег `v*.*.*` — build, push image, upload docs, create GitHub Release с CHANGELOG.                                                                                   |

---

## 4 P — **Push**

```bash
git add .
git commit -m "docs: complete typing, coverage ≥85 %, mkdocs site & release workflow"
git push origin master
```

После merge:

* **GitHub Actions** выполняет lint → type-check → tests (coverage ≥ 85 %) → CI зелёный.
* **Docs site** доступен по GitHub Pages.
* Следующий тег `v1.0.0` автоматически соберёт образ и сформирует релиз-ноты.

Проект считается «Production-ready».
